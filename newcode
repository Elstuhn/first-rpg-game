import pickle
import os
import shutil
import sys
import random
import typing
curdir = os.getcwd()
gamefile = curdir+'/adventurefile'
def clearscreen():
	print("\n"*35)

def savegame():
	with open(gamefile+'/inventory', 'wb') as writefile:
		pickle.dump(pinv, writefile)
	#inventory will be a nested list object ([0, 0] = item(string) [0, 1] = quantity(int))
	
	with open(gamefile+'/gear', 'wb') as writefile:
		pickle.dump(pgear, writefile)
	#pgear will be a list object
		
	with open(gamefile+'/playerstats', 'wb') as writefile:
		pickle.dump(pstats, writefile)
	#playerstats will be a class instance object
		
	
def equip(num : int):
#num is the number of the equipment in the inventory
#inventory will be enumerated so order will start from 0
	try:
		pinv[num]
		gearequip = pinv[num]
		if not gearequip in gear_list:
			return "Sorry, you cannot equip that!"
		elif gearequip in pgear:
			return "You already have that equipped!"

		equipmentid = gear_id[gearequip]
		#equipmentid access gear_id dictionary to retrieve string form of equipment's id
		for i in pgear:
			gearid = gear_id[i]
			if gearid == equipmentid:
				ver = input("Would you like to unequip old gear and re-equip new gear? (yes/no)\n")
				while not ver.lower() in ['yes', 'no']:
					ver = input("would you like to unequip old gear and re-equip new gear? (yes/no)\n")
				if ver.lower() == 'no':
					return
				else:
					gearunequip = pgear.pop(equipmentid)
					if pinv[num][1]>1:
						pinv[num][1] -=1
						gearequip = pinv[num][0]
						pgear[equipmentid] = gearequip
					else:
						
					#equipment ids correlate with pgear index
					pinv.append(gearunequip)
					pgear[equipmentid] = pinv[num]
					del pinv[num]
			
			
	except:

		elif not inventory[num] in gear_list 
	
def load_game():
	with open(gamefile+'/gear', 'rb') as readfile:
		pgear = pickle.load(readfile)
	with open(gamefile+'/inventory', 'rb') as readfile:
		pinv = pickle.load(readfile)
	with open(gamefile+'/playerstats', 'rb') as readfile:
		pstats = pickle.load(readfile)

class Player():
	def __init__(self, hp : int, def : int, attack : int, dung : list):
		self.hp = hp
		self.def = def
		self.atk = attack
		self.curhp = hp
		self.dun = dung
		
	def dmgtake(self, health : int):
		self.curhp -= health
		
	def dmgdone(self):
		maxatk = (self.atk*2)//1.5
		dmgdone = random.randint(self.atk, maxatk)
		return dmgdone
		
	def dunupdate(self, dungeon_number : int):
		self.dung.append(dungeon_list[dungeon_number-1])
	

def credits():
	print("\nGame Development: Elston\nDirector: Elston\nScripter: Elston")

def menuscreen():
	space = "|" + " "*25 + "|"
	print("-"*25)
	print(space)
	print("| 1)  New Game" + " "*12 + "|")
	print("|" + " "*25 + "|")
	print("| 2) Resume Game" + " "*12 + "|")
	print("|" + " "*25 + "|")
	print("| 3) Credits" + " "*12 + "|")
	print("-"*25)
	
bool = os.path.isdir(curdir+'/adventurefile')	

while True:
	menuscreen()
	option = input("\n\n")
	while any([
		not option in ['1', '2', '3'],
		not bool and option == '2'
		]):
		if not bool and option == '2':
			print("Error | Save file not found.")
		else:
			print("Invalid Input | Please enter a valid option given")
			time.sleep(1)
			print("\n"*3)
			clearscreen()
			option = input("\n\n")
	if option == '1':
		ver = input("Are you sure you want to create a new game?\nThis might wipe out your existing save files (yes/no)\n")
		while not ver.lower() in ['yes', 'no']:
			ver = input("Are you sure you want to create a new game?\nThis will wipe out any of your existing save files (yes/no)\n")
		if ver.lower() == 'yes':
			try:
				os.mkdir(gamefile)
				open(gamefile+'/gear', 'x')
				open(gamefile+'/inventory', 'x')
				open(gamefile+'/playerstats', 'x')
				
				break
			except:
				shutil.rmtree(gamefile)
				os.mkdir(gamefile)
		else:	
			pass

	
